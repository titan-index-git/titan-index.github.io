<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Titan Index — Economic Dashboard (Feb 2025 – Feb 2026)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#060a13;--surface:#0d1117;--surface-2:#161b22;
  --border:#21262d;--border-lt:#30363d;
  --text:#e6edf3;--text-m:#8b949e;--text-d:#484f58;
  --green:#3fb950;--red:#f85149;--blue:#58a6ff;--amber:#d29922;--purple:#bc8cff;--orange:#f0883e;
  --max-w:1440px;--radius:10px;
  --ind-w:200px;--base-w:90px;
}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;-webkit-font-smoothing:antialiased}
a{color:var(--blue);text-decoration:none}a:hover{text-decoration:underline}

/* Hero */
.hero{position:relative;overflow:hidden;background:var(--bg);border-bottom:1px solid var(--border)}
.hero-glow{position:absolute;top:-120px;left:50%;transform:translateX(-50%);width:1000px;height:500px;background:radial-gradient(ellipse,rgba(88,166,255,.14) 0%,rgba(188,140,255,.07) 40%,transparent 70%);filter:blur(60px);pointer-events:none;animation:hero-pulse 8s ease-in-out infinite}
.hero-canvas{position:absolute;inset:0;width:100%;height:100%;pointer-events:none}
.hero-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(88,166,255,.04) 1px,transparent 1px),linear-gradient(90deg,rgba(88,166,255,.04) 1px,transparent 1px);background-size:48px 48px;-webkit-mask-image:linear-gradient(to bottom,rgba(0,0,0,.5),transparent);mask-image:linear-gradient(to bottom,rgba(0,0,0,.5),transparent);pointer-events:none}
@keyframes hero-pulse{0%,100%{opacity:.6}50%{opacity:1}}
@keyframes title-shimmer{0%,85%{background-position:0% 50%}95%,100%{background-position:100% 50%}}

.header{text-align:center;padding:44px 20px 8px;position:relative;z-index:1}
.header h1{font-size:34px;font-weight:700;letter-spacing:-1px;background:linear-gradient(90deg,#58a6ff,#bc8cff 40%,#d4e4ff 50%,#bc8cff 60%,#58a6ff 100%);background-size:250% 100%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;color:#58a6ff;animation:title-shimmer 30s ease-in-out infinite}
.header .sub{color:var(--text-m);font-size:15px;margin-top:4px}

.pulse{display:flex;gap:0;overflow-x:auto;padding:14px 0;margin:0 auto 8px;max-width:var(--max-w);justify-content:center;scrollbar-width:none;position:relative;z-index:1}
.pulse::-webkit-scrollbar{display:none}
.pulse-item{display:flex;align-items:center;gap:6px;padding:6px 16px;font-size:13px;white-space:nowrap;border-right:1px solid var(--border)}
.pulse-item:last-child{border-right:none}
.pulse-label{color:var(--text-m);font-weight:500}
.pulse-val{font-weight:600;font-variant-numeric:tabular-nums}
.pulse-up{color:var(--green)}.pulse-dn{color:var(--red)}

.container{max-width:var(--max-w);margin:0 auto;padding:0 20px 40px}

/* Narrative */
.narrative-card{background:linear-gradient(135deg,#0d1117,#161b22);border:1px solid var(--border);border-radius:14px;padding:28px 32px;margin-bottom:32px;box-shadow:0 8px 32px rgba(0,0,0,.3)}
.narrative-card .byline{font-size:12px;color:var(--text-d);text-transform:uppercase;letter-spacing:1px;margin-bottom:16px}
.narrative-card h2{font-size:22px;font-weight:700;margin-bottom:16px;line-height:1.3}
.narrative-card .dropcap::first-letter{float:left;font-size:52px;line-height:1;font-weight:700;margin:0 10px -4px 0;color:var(--blue)}
.narrative-card p{font-size:15px;color:var(--text-m);margin-bottom:14px;line-height:1.8;text-align:justify}
.narrative-card p strong{color:var(--text)}

.summary-card{background:linear-gradient(135deg,#0d1117,#161b22);border:1px solid var(--border);border-radius:14px;padding:24px;margin-bottom:32px;box-shadow:0 8px 32px rgba(0,0,0,.3)}
.summary-title{font-size:20px;font-weight:600;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.summary-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.sum-sec h3{font-size:15px;font-weight:600;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.sum-sec ul{margin-left:18px;font-size:14px;color:var(--text-m);line-height:1.7}
.sum-sec ul strong{color:var(--text)}
.hl-g h3{color:var(--green)}.hl-b h3{color:var(--red)}
.sum-div{grid-column:1/-1;border-top:1px solid var(--border);padding-top:16px}
.sum-div h3{color:var(--amber);font-size:15px;font-weight:600;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.sum-div ul{margin-left:18px;font-size:14px;color:var(--text-m);line-height:1.7}
.sum-div ul strong{color:var(--text)}

.section{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:24px;overflow:hidden}
.section-hdr{display:flex;align-items:center;gap:10px;padding:14px 20px;font-size:17px;font-weight:600;border-bottom:1px solid var(--border);background:var(--surface-2)}

/* Slider bar */
.time-slider-bar{display:flex;align-items:center;gap:12px;padding:8px 20px;background:var(--surface-2);border-bottom:1px solid var(--border);font-size:12px;color:var(--text-m)}
.time-slider-bar label{white-space:nowrap;font-weight:500}
.time-slider{flex:1;-webkit-appearance:none;appearance:none;height:6px;background:var(--border);border-radius:3px;outline:none;cursor:pointer}
.time-slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:18px;height:18px;border-radius:50%;background:var(--blue);cursor:pointer;border:2px solid var(--surface)}
.time-slider::-moz-range-thumb{width:18px;height:18px;border-radius:50%;background:var(--blue);cursor:pointer;border:2px solid var(--surface)}
.time-slider-range{font-weight:600;color:var(--text);min-width:140px;text-align:right}

.table-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch;scroll-behavior:smooth}
.table-wrap::-webkit-scrollbar{height:6px}
.table-wrap::-webkit-scrollbar-track{background:var(--surface)}
.table-wrap::-webkit-scrollbar-thumb{background:var(--border-lt);border-radius:3px}

.t{width:100%;border-collapse:separate;border-spacing:0;font-size:13px;font-variant-numeric:tabular-nums}
.t th{background:var(--surface-2);color:var(--text-m);font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:.5px;padding:10px;text-align:center;border-bottom:1px solid var(--border);white-space:nowrap}
.t td{padding:9px 10px;text-align:center;border-bottom:1px solid rgba(33,38,45,.6);white-space:nowrap}

/* Sticky indicator name column */
.t th:first-child,.t td:first-child{
  position:sticky;left:0;z-index:4;
  text-align:left;min-width:var(--ind-w);max-width:var(--ind-w);
  background:var(--surface);box-shadow:2px 0 8px rgba(0,0,0,.3)
}
.t th:first-child{background:var(--surface-2)}
.t td:first-child{font-weight:500}

/* Sticky baseline column (Feb 25) */
.t th:nth-child(2),.t td:nth-child(2){
  position:sticky;left:var(--ind-w);z-index:3;
  background:var(--surface);
  border-right:2px solid var(--blue);
  box-shadow:2px 0 8px rgba(0,0,0,.2)
}
.t th:nth-child(2){background:var(--surface-2);color:var(--blue)}

.t tbody tr{cursor:pointer;transition:background .15s}
.t tbody tr:hover{background:rgba(88,166,255,.07)}
.t tbody tr:hover td:first-child,
.t tbody tr:hover td:nth-child(2){background:var(--surface)}

.ind-link{color:var(--text);text-decoration:none;font-weight:500;transition:color .15s}
.ind-link:hover{color:var(--blue);text-decoration:underline}

.v-g{color:var(--green)}.v-b{color:var(--red)}.v-f{color:var(--text-d)}.v-base{color:var(--text)}
.ch-g{color:var(--green);font-weight:600}.ch-b{color:var(--red);font-weight:600}.ch-n{color:var(--text-d);font-weight:500}
.spark{display:block;margin:0 auto}

/* Modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;pointer-events:none;transition:opacity .2s}
.modal-overlay.open{opacity:1;pointer-events:auto}
.modal-box{background:var(--surface);border:1px solid var(--border);border-radius:16px;width:92%;max-width:900px;max-height:88vh;overflow-y:auto;box-shadow:0 24px 64px rgba(0,0,0,.5)}
.modal-top{display:flex;align-items:center;justify-content:space-between;padding:18px 24px;border-bottom:1px solid var(--border)}
.modal-top h3{font-size:18px;font-weight:600}
.modal-x{background:none;border:none;color:var(--text-m);font-size:24px;cursor:pointer;padding:4px 8px;border-radius:6px;transition:background .15s}
.modal-x:hover{background:var(--surface-2);color:var(--text)}
.modal-body{padding:24px}
.modal-tabs{display:flex;gap:0;margin-bottom:16px;border-bottom:1px solid var(--border)}
.modal-tab{padding:8px 20px;font-size:13px;font-weight:600;color:var(--text-m);cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;background:none;border-top:none;border-left:none;border-right:none}
.modal-tab:hover{color:var(--text)}
.modal-tab.active{color:var(--blue);border-bottom-color:var(--blue)}
.modal-chart-wrap{position:relative}
.modal-chart-wrap canvas{width:100%!important;height:auto!important;aspect-ratio:16/9;display:block}
.modal-stats{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap}
.modal-stat{background:var(--surface-2);border-radius:8px;padding:10px 16px;font-size:13px;flex:1;min-width:100px}
.modal-stat .lbl{color:var(--text-m);font-size:11px;text-transform:uppercase;letter-spacing:.5px;margin-bottom:2px}
.modal-stat .val{font-weight:600;font-size:17px}
.modal-src{margin-top:16px;font-size:12px;color:var(--text-m)}
.modal-src a{color:var(--blue)}

/* Richter Scale */
.richter-card{background:linear-gradient(135deg,#0d1117,#161b22);border:1px solid var(--border);border-radius:14px;padding:24px;margin-bottom:32px;box-shadow:0 8px 32px rgba(0,0,0,.3)}
.richter-title{font-size:20px;font-weight:600;margin-bottom:6px;display:flex;align-items:center;gap:8px}
.richter-subtitle{font-size:13px;color:var(--text-m);margin-bottom:20px}
.richter-row{display:grid;grid-template-columns:180px 1fr 80px;align-items:center;gap:16px;padding:12px 0;border-bottom:1px solid var(--border)}
.richter-row:last-child{border-bottom:none}
.richter-label{font-size:13px;font-weight:600}
.richter-label span{display:block;font-size:11px;color:var(--text-m);font-weight:400;margin-top:2px}
.richter-bar-wrap{position:relative;height:28px;background:var(--surface-2);border-radius:14px;overflow:visible;margin:18px 0}
.richter-bar-bg{position:absolute;inset:0;background:linear-gradient(90deg,#3fb950 0%,#3fb950 25%,#d29922 25%,#d29922 50%,#f0883e 50%,#f0883e 75%,#f85149 75%,#f85149 100%);opacity:.15;border-radius:14px;overflow:hidden}
.richter-markers{position:absolute;inset:0;display:flex;align-items:center;pointer-events:none}
.richter-marker{position:absolute;width:3px;height:18px;border-radius:2px;opacity:.7}
.richter-marker.current{width:14px;height:14px;border-radius:50%;border:2px solid #fff;z-index:2;opacity:1}
.richter-marker-label{position:absolute;top:-18px;font-size:9px;color:var(--text-d);white-space:nowrap;transform:translateX(-50%)}
.richter-score{font-size:20px;font-weight:700;text-align:center}
.richter-legend{display:flex;gap:16px;margin-top:16px;justify-content:center;flex-wrap:wrap}
.richter-legend-item{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text-m)}
.richter-legend-dot{width:10px;height:10px;border-radius:50%}
.richter-overall{text-align:center;margin-top:20px;padding-top:20px;border-top:1px solid var(--border)}
.richter-overall .score{font-size:48px;font-weight:700}
.richter-overall .label{font-size:14px;color:var(--text-m);margin-top:4px}
.richter-overall .desc{font-size:13px;color:var(--text-d);margin-top:8px;max-width:500px;margin-left:auto;margin-right:auto}

.footer{text-align:center;padding:20px;color:var(--text-d);font-size:12px;border-top:1px solid var(--border);margin-top:20px}

@media(max-width:768px){
  :root{--ind-w:160px;--base-w:80px}
  .summary-grid{grid-template-columns:1fr}
  .header h1{font-size:26px}
  .pulse-item{padding:4px 10px;font-size:12px}
  .richter-row{grid-template-columns:120px 1fr 60px;gap:8px}
  .narrative-card{padding:20px 18px}
  .subscribe-form{flex-direction:column}
}

/* Light theme */
[data-theme="light"]{
  --bg:#f6f8fa;--surface:#ffffff;--surface-2:#f0f3f6;
  --border:#d0d7de;--border-lt:#d8dee4;
  --text:#1f2328;--text-m:#656d76;--text-d:#8b949e;
}
[data-theme="light"] .narrative-card,
[data-theme="light"] .summary-card,
[data-theme="light"] .richter-card,
[data-theme="light"] .subscribe-card{background:linear-gradient(135deg,#fff,#f6f8fa);box-shadow:0 8px 32px rgba(0,0,0,.06)}
[data-theme="light"] .section{border-color:var(--border)}
[data-theme="light"] .t th:first-child,
[data-theme="light"] .t td:first-child{box-shadow:2px 0 8px rgba(0,0,0,.06)}
[data-theme="light"] .t th:nth-child(2),
[data-theme="light"] .t td:nth-child(2){box-shadow:2px 0 8px rgba(0,0,0,.04)}
[data-theme="light"] .modal-overlay{background:rgba(0,0,0,.3)}
[data-theme="light"] .modal-box{box-shadow:0 24px 64px rgba(0,0,0,.12)}
[data-theme="light"] .richter-bar-bg{opacity:.25}
[data-theme="light"] .t tbody tr:hover{background:rgba(88,166,255,.1)}
[data-theme="light"] .t tbody tr:hover td:first-child,
[data-theme="light"] .t tbody tr:hover td:nth-child(2){background:var(--surface)}
[data-theme="light"] .header h1{background:linear-gradient(90deg,#0969da,#8250df 40%,#a8c8f0 50%,#8250df 60%,#0969da 100%);background-size:250% 100%;-webkit-background-clip:text;background-clip:text;animation:title-shimmer 30s ease-in-out infinite}
[data-theme="light"] .hero-glow{background:radial-gradient(ellipse,rgba(9,105,218,.1) 0%,rgba(130,80,223,.05) 40%,transparent 70%)}
[data-theme="light"] .hero-grid{background-image:linear-gradient(rgba(9,105,218,.07) 1px,transparent 1px),linear-gradient(90deg,rgba(9,105,218,.07) 1px,transparent 1px)}
[data-theme="light"] .footer{border-top-color:var(--border)}

/* Theme toggle */
.theme-toggle{position:absolute;right:20px;top:20px;background:var(--surface-2);border:1px solid var(--border);color:var(--text-m);border-radius:8px;padding:6px 10px;cursor:pointer;font-size:18px;line-height:1;transition:all .15s}
.theme-toggle:hover{color:var(--text);border-color:var(--border-lt)}

/* Subscribe card */
.subscribe-card{background:linear-gradient(135deg,#0d1117,#161b22);border:1px solid var(--border);border-radius:14px;padding:28px 32px;margin-top:8px;margin-bottom:32px;box-shadow:0 8px 32px rgba(0,0,0,.3);text-align:center}
.subscribe-card h3{font-size:20px;font-weight:600;margin-bottom:6px}
.subscribe-card p{font-size:14px;color:var(--text-m);margin-bottom:16px}
.subscribe-form{display:flex;gap:8px;max-width:420px;margin:0 auto}
.subscribe-form input[type="email"]{flex:1;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:14px;outline:none;transition:border-color .15s}
.subscribe-form input[type="email"]:focus{border-color:var(--blue)}
.subscribe-form input[type="email"]::placeholder{color:var(--text-d)}
.subscribe-btn{padding:10px 20px;border-radius:8px;border:none;background:var(--blue);color:#fff;font-size:14px;font-weight:600;cursor:pointer;white-space:nowrap;transition:opacity .15s}
.subscribe-btn:hover{opacity:.9}
.subscribe-btn:disabled{opacity:.6;cursor:not-allowed}
.subscribe-msg{margin-top:12px;font-size:13px;min-height:20px}
.subscribe-msg.success{color:var(--green)}
.subscribe-msg.error{color:var(--red)}
</style>
<script>(function(){var t=localStorage.getItem('titan-theme');document.documentElement.dataset.theme=t||'light'})()</script>
</head>
<body>

<div class="hero">
  <div class="hero-glow"></div>
  <canvas class="hero-canvas" id="hero-canvas"></canvas>
  <div class="hero-grid"></div>
  <header class="header">
    <h1>The Titan Index</h1>
    <p class="sub">Real Data Dashboard &mdash; Feb 2025 &ndash; Feb 2026</p>
    <button class="theme-toggle" id="theme-toggle" title="Switch to light mode">&#9790;</button>
  </header>
  <div class="pulse" id="pulse"></div>
</div>
<main class="container">
  <div id="narrative"></div>
  <div id="summary"></div>
  <div id="sections"></div>
  <div id="richter"></div>
  <div id="subscribe" class="subscribe-card">
    <h3>Stay in the Loop</h3>
    <p>Get the Titan Index delivered to your inbox each month.</p>
    <form class="subscribe-form" id="subscribe-form">
      <input type="email" id="subscribe-email" placeholder="you@example.com" required>
      <button type="submit" class="subscribe-btn">Subscribe</button>
    </form>
    <div class="subscribe-msg" id="subscribe-msg"></div>
  </div>
</main>

<div class="modal-overlay" id="modal">
  <div class="modal-box">
    <div class="modal-top">
      <h3 id="modal-title"></h3>
      <button class="modal-x" id="modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <div class="modal-tabs" id="modal-tabs">
        <button class="modal-tab active" data-tab="12m">Past 12 Months</button>
        <button class="modal-tab" data-tab="20y">20-Year Trend</button>
      </div>
      <div class="modal-chart-wrap">
        <canvas id="modal-canvas"></canvas>
      </div>
      <div class="modal-stats" id="modal-stats"></div>
      <div class="modal-src" id="modal-src"></div>
    </div>
  </div>
</div>

<footer class="footer">
  The Titan Index &mdash; Data compiled Feb 2025 &ndash; Feb 2026 &middot; Click any indicator name for source data &middot; Click any row to view chart
</footer>

<script>
// ── DATA ──
const MONTHS = ["Feb 25","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","Jan 26","Feb 26"];
const HIST_YEARS = ['06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26'];

const SECTIONS = [
  { title:"General Macroeconomics", icon:"\u{1F4CA}", accent:"#d29922", indicators:[
    { name:"CPI Inflation Rate (%)", data:[2.8,2.4,2.3,2.4,2.7,2.7,2.9,3.0,2.9,2.7,2.7,2.4,2.4], upIsBad:true, dec:1,
      hist:[3.2,2.8,3.8,-0.4,1.6,3.2,2.1,1.5,1.6,0.1,1.3,2.1,2.4,1.8,1.2,4.7,8.0,4.1,2.9,2.8,2.4],
      url:"https://www.bls.gov/cpi/" },
    { name:"Unemployment Rate (%)", data:[4.2,4.2,4.2,4.3,4.1,4.3,4.3,4.4,4.4,4.5,4.4,4.3,4.3], upIsBad:true, dec:1,
      hist:[4.6,4.6,5.8,9.3,9.6,8.9,8.1,7.4,6.2,5.3,4.9,4.4,3.9,3.7,8.1,5.4,3.6,3.6,4.0,4.2,4.3],
      url:"https://www.bls.gov/news.release/empsit.nr0.htm" },
    { name:"Consumer Confidence", data:[98.3,92.9,86.0,98.0,93.0,97.2,105.6,95.6,94.6,92.9,89.1,84.5,80.0], upIsBad:false, dec:1,
      hist:[105.9,103.4,57.9,53.5,54.5,58.8,65.1,73.2,86.9,98.0,99.8,120.5,130.1,128.2,101.0,112.7,104.5,101.3,100.1,95.0,80.0],
      url:"https://www.conference-board.org/topics/consumer-confidence" },
    { name:"Presidential Approval (%)", data:[48.0,47.0,44.0,47.0,45.0,44.0,44.0,43.0,43.0,42.0,42.0,42.0,42.0], upIsBad:false, dec:1,
      hist:[37.0,33.0,25.0,57.0,47.0,44.0,49.0,46.0,42.0,46.0,49.0,39.0,40.0,45.0,49.0,44.0,40.0,39.0,38.0,48.0,42.0],
      url:"https://news.gallup.com/poll/203198/presidential-approval-ratings-donald-trump.aspx" },
    { name:"Fed Funds Rate (%)", data:[4.3,4.3,4.3,4.3,4.3,4.3,4.3,4.2,4.1,3.9,3.7,3.6,3.6], upIsBad:true, dec:1,
      hist:[5.0,5.0,1.9,0.2,0.2,0.1,0.1,0.1,0.1,0.1,0.4,1.0,1.8,2.2,0.4,0.1,1.7,5.0,5.1,4.2,3.6],
      url:"https://fred.stlouisfed.org/series/FEDFUNDS" },
    { name:"Personal Savings Rate (%)", data:[5.2,5.1,5.5,4.9,4.6,4.3,4.1,4.0,3.7,3.5,3.4,3.3,3.2], upIsBad:false, dec:1,
      hist:[2.8,2.5,4.1,5.7,5.9,6.6,7.9,5.0,5.5,5.8,5.4,5.8,6.4,7.3,15.1,11.3,3.3,5.6,5.4,4.5,3.2],
      url:"https://fred.stlouisfed.org/series/PSAVERT" },
    { name:"GDP Growth (%)", data:[-0.6,-0.6,3.8,3.8,3.8,4.4,4.4,4.4,3.7,3.7,3.7,2.1,2.1], upIsBad:false, dec:1,
      hist:[3.5,2.5,-8.5,4.4,2.1,4.6,0.5,3.5,2.0,0.7,2.2,4.6,0.6,2.8,4.6,7.0,2.8,3.4,1.9,3.7,2.1],
      url:"https://fred.stlouisfed.org/series/A191RL1Q225SBEA" },
    { name:"Real Wage Growth (%)", data:[1.2,1.4,1.6,1.6,1.0,1.2,0.7,0.8,1.1,0.8,0.6,1.5,1.4], upIsBad:false, dec:1,
      hist:[0.4,0.0,-0.1,2.3,0.1,-1.2,0.1,0.4,0.3,2.4,1.4,0.6,1.1,1.2,4.2,0.2,-3.1,0.0,1.2,1.1,1.3],
      url:"https://www.bls.gov/news.release/realer.nr0.htm" }
  ]},
  { title:"Market Performance", icon:"\u{1F4C8}", accent:"#3fb950", indicators:[
    { name:"DJIA", data:[43840,41990,40528,42216,43819,44131,45545,46316,47563,47716,48063,48892,49501], upIsBad:false, dec:0,
      hist:[12463,13265,8776,10428,11578,12218,13104,16577,17823,17425,19763,24719,23327,28538,30606,36338,33147,37690,42544,48063,49501],
      url:"https://finance.yahoo.com/quote/%5EDJI/" },
    { name:"NASDAQ", data:[18847,17450,17461,19176,20370,21122,21456,22660,23581,23215,23242,23462,22547], upIsBad:false, dec:0,
      hist:[2415,2652,1577,2269,2653,2605,3020,4177,4736,5007,5383,6903,6635,8973,12888,15645,10466,15011,16825,23242,22547],
      url:"https://finance.yahoo.com/quote/%5EIXIC/" },
    { name:"S&P 500", data:[5955,5612,5569,5916,6205,6339,6460,6661,6840,6849,6846,6939,6836], upIsBad:false, dec:0,
      hist:[1418,1468,903,1115,1258,1258,1426,1848,2059,2044,2239,2674,2507,3231,3756,4766,3840,4770,5881,6846,6836],
      url:"https://finance.yahoo.com/quote/%5EGSPC/" }
  ]},
  { title:"Debt & Income", icon:"\u{1F4B3}", accent:"#bc8cff", indicators:[
    { name:"Median Household Income ($)", data:[84100,84200,84400,84500,84700,84900,85100,85200,85300,85400,85500,85700,85800], upIsBad:false, dec:0,
      hist:[48201,50233,50303,49777,49276,50054,51017,51939,53657,56516,59039,61372,63179,68703,67521,70784,74580,80610,81520,84100,85800],
      url:"https://fred.stlouisfed.org/series/MEHOINUSA672N" },
    { name:"Avg Fed Tax Rate (%)", data:[14.0,14.0,14.0,14.0,14.0,13.8,13.8,13.8,13.8,13.8,13.8,13.5,13.5], upIsBad:true, dec:1,
      hist:[14.2,14.0,12.7,11.1,11.5,12.4,13.8,14.0,13.6,13.9,13.8,13.6,13.0,13.0,10.6,13.2,13.6,14.0,14.0,14.0,13.5],
      url:"https://taxfoundation.org/data/all/federal/average-federal-tax-rates-income-group/" },
    { name:"Avg Credit Card Debt ($)", data:[10788,10600,10500,10700,10951,11000,11019,11050,11100,11227,11300,11100,11000], upIsBad:true, dec:0,
      hist:[5800,6200,6700,6200,5600,5400,5400,5600,5700,5900,6100,6400,6700,6800,5900,5900,6900,7900,9700,10788,11000],
      url:"https://www.newyorkfed.org/microeconomics/hhdc" },
    { name:"Student Loan Debt ($T)", data:[1.63,1.63,1.64,1.64,1.64,1.65,1.65,1.65,1.66,1.66,1.66,1.67,1.67], upIsBad:true, dec:2,
      hist:[0.52,0.59,0.68,0.77,0.86,0.96,1.05,1.15,1.24,1.32,1.41,1.49,1.57,1.64,1.69,1.73,1.76,1.73,1.78,1.79,1.80],
      url:"https://www.newyorkfed.org/microeconomics/hhdc" },
    { name:"National Debt ($T)", data:[36.22,36.22,36.21,36.21,36.22,36.68,37.18,37.60,37.85,38.09,38.40,38.43,38.56], upIsBad:true, dec:2,
      hist:[8.51,9.01,10.02,11.91,13.56,14.79,16.07,16.74,17.82,18.15,19.57,20.24,21.52,22.72,27.75,28.43,30.93,33.17,35.46,37.60,38.56],
      url:"https://fiscaldata.treasury.gov/datasets/debt-to-the-penny/" }
  ]},
  { title:"Housing", icon:"\u{1F3E0}", accent:"#58a6ff", indicators:[
    { name:"30-Yr Mortgage Rate (%)", data:[6.87,6.65,6.64,6.81,6.85,6.67,6.58,6.35,6.30,6.22,6.20,6.10,6.09], upIsBad:true, dec:2,
      hist:[6.41,6.34,6.03,5.04,4.69,4.45,3.66,3.98,4.17,3.85,3.65,3.99,4.54,3.94,3.11,2.96,5.34,6.81,6.72,6.64,6.09],
      url:"https://www.freddiemac.com/pmms" },
    { name:"Median Home Price ($)", data:[398400,403700,414000,422800,435300,422400,422600,415200,415200,409200,405400,396800,396000], upIsBad:true, dec:0,
      hist:[222000,219000,198600,172500,173100,166200,177200,197400,209500,223900,236400,248800,261600,272200,296500,352800,392800,389800,407600,414000,396000],
      url:"https://www.nar.realtor/research-and-statistics/housing-statistics/existing-home-sales" },
    { name:"Price-to-Income Ratio", data:[4.74,4.80,4.91,5.00,5.14,4.97,4.96,4.87,4.87,4.79,4.74,4.63,4.62], upIsBad:true, dec:2,
      hist:[4.54,4.28,3.85,3.38,3.40,3.22,3.36,3.64,3.78,3.85,3.88,3.94,4.02,3.84,4.26,4.84,5.11,4.70,4.86,4.87,4.62],
      url:"https://fred.stlouisfed.org/series/ASPUS" },
    { name:"Median Rent ($/mo)", data:[1986,2005,2032,2049,2069,2062,2041,2000,1949,1925,1901,1895,1900], upIsBad:true, dec:0,
      hist:[763,789,824,842,855,871,884,905,934,1381,1434,1492,1547,1594,1608,1764,2007,2029,1997,2000,1900],
      url:"https://www.zillow.com/research/data/" }
  ]},
  { title:"Grocery Prices", icon:"\u{1F6D2}", accent:"#f0883e", indicators:[
    { name:"Milk ($/gal)", data:[4.19,4.24,4.20,4.18,4.16,4.16,4.15,4.13,4.10,4.00,4.05,4.10,4.10], upIsBad:true, dec:2,
      hist:[3.07,3.87,3.71,3.00,3.32,3.57,3.53,3.46,3.69,3.42,3.21,3.23,2.90,3.08,3.32,3.66,4.21,4.10,4.15,4.16,4.10],
      url:"https://fred.stlouisfed.org/series/APU0000709112" },
    { name:"Eggs ($/dozen)", data:[5.90,6.23,5.12,4.55,3.78,3.60,3.59,3.49,3.20,2.86,2.71,2.58,2.50], upIsBad:true, dec:2,
      hist:[1.31,1.68,2.18,1.55,1.67,1.84,1.81,1.93,2.01,2.75,1.58,1.49,1.54,1.40,1.48,1.67,2.86,2.51,3.65,4.15,2.50],
      url:"https://fred.stlouisfed.org/series/APU0000708111" },
    { name:"Bread ($/lb)", data:[1.93,1.88,1.91,1.88,1.86,1.85,1.84,1.87,1.83,1.79,1.83,1.84,1.84], upIsBad:true, dec:2,
      hist:[1.08,1.21,1.37,1.39,1.37,1.45,1.42,1.41,1.40,1.44,1.37,1.33,1.29,1.30,1.45,1.52,1.70,1.96,1.97,1.87,1.84],
      url:"https://fred.stlouisfed.org/series/APU0000702111" },
    { name:"Chicken ($/lb)", data:[2.05,2.06,2.06,2.06,2.09,2.08,2.08,2.06,2.05,2.04,2.02,2.04,2.04], upIsBad:true, dec:2,
      hist:[1.05,1.12,1.21,1.28,1.26,1.29,1.42,1.50,1.53,1.49,1.46,1.47,1.50,1.50,1.56,1.53,1.80,1.91,2.00,2.06,2.04],
      url:"https://fred.stlouisfed.org/series/APU0000706111" }
  ]},
  { title:"Auto & Fuel", icon:"\u{26FD}", accent:"#e06c75", indicators:[
    { name:"Gas Price ($/gal)", data:[3.12,3.07,3.17,3.15,3.15,3.13,3.13,3.17,3.12,3.08,2.89,2.83,2.93], upIsBad:true, dec:2,
      hist:[2.59,2.80,3.27,2.35,2.79,3.53,3.64,3.53,3.37,2.43,2.14,2.42,2.72,2.60,2.17,3.01,3.97,3.52,3.31,3.13,2.93],
      url:"https://www.eia.gov/dnav/pet/pet_pri_gnd_dcus_nus_w.htm" },
    { name:"New Car Price ($)", data:[48039,47462,48699,48799,48907,48841,49077,50022,49766,49814,50326,49191,49400], upIsBad:true, dec:0,
      hist:[27958,28419,28350,28966,29217,30659,31144,31252,32386,33543,34077,35285,36115,37185,38585,42258,48094,47362,47896,49077,49400],
      url:"https://www.coxautoinc.com/market-insights/kbb-atp/" }
  ]}
];

// ── RICHTER SCALE DATA ──
const RICHTER_DATA = [
  { name:"S&P 500 Drawdown",sub:"From all-time high",
    current:-1.5, gfc:-56.8, covid:-33.9, dotcom:-49.1, unit:"%",
    invert:true, max:60 },
  { name:"Unemployment",sub:"Current rate",
    current:4.3, gfc:10.0, covid:14.7, dotcom:6.3, unit:"%",
    invert:false, max:15 },
  { name:"Consumer Confidence",sub:"Conference Board Index",
    current:80.0, gfc:25.3, covid:85.7, dotcom:61.4, unit:"",
    invert:true, max:140 },
  { name:"CPI Inflation",sub:"Year-over-year",
    current:2.4, gfc:5.6, covid:1.2, dotcom:3.4, unit:"%",
    invert:false, max:10 },
  { name:"Mortgage Rate",sub:"30-year fixed",
    current:6.09, gfc:6.03, covid:3.11, dotcom:6.97, unit:"%",
    invert:false, max:10 },
  { name:"Home Price Change",sub:"YoY % change",
    current:-0.6, gfc:-12.4, covid:5.7, dotcom:7.5, unit:"%",
    invert:true, max:15 },
  { name:"Credit Card Debt",sub:"Per household",
    current:11000, gfc:6700, covid:5900, dotcom:4200, unit:"$",
    invert:false, max:12000 }
];

// ── UTILITIES ──
function fmt(v,d){return v.toLocaleString('en-US',{minimumFractionDigits:d,maximumFractionDigits:d})}
function fmtPct(v){
  if(Math.abs(v)<0.01)return '\u2014';
  return (v>0?'+':'')+v.toFixed(1)+'%';
}
function cellCls(cur,prev,bad){if(cur>prev)return bad?'v-b':'v-g';if(cur<prev)return bad?'v-g':'v-b';return 'v-f'}
function chgCls(delta,bad){if(Math.abs(delta)<0.01)return'ch-n';return((delta>0)===bad)?'ch-b':'ch-g'}
function pctChgCls(pct,bad){if(Math.abs(pct)<0.01)return'ch-n';return((pct>0)===bad)?'ch-b':'ch-g'}
function hexRgba(hex,a){const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);return`rgba(${r},${g},${b},${a})`}

function sparkSVG(data,upIsBad){
  const W=110,H=28,P=2,first=data[0],last=data[data.length-1],delta=last-first;
  const good=(delta>0&&!upIsBad)||(delta<0&&upIsBad)||Math.abs(delta)<0.001;
  const color=Math.abs(delta)<0.001?'#8b949e':good?'#3fb950':'#f85149';
  const fill=Math.abs(delta)<0.001?'rgba(139,148,158,.1)':good?'rgba(63,185,80,.15)':'rgba(248,81,73,.15)';
  const min=Math.min(...data),max=Math.max(...data),range=max-min||1;
  const pts=data.map((v,i)=>{const x=P+(i/(data.length-1))*(W-2*P);const y=P+(1-(v-min)/range)*(H-2*P);return[x,y]});
  const line=pts.map(p=>p.join(',')).join(' ');
  const area=line+` ${pts[pts.length-1][0]},${H} ${pts[0][0]},${H}`;
  return`<svg class="spark" viewBox="0 0 ${W} ${H}" width="${W}" height="${H}" role="img" aria-label="Trend sparkline"><polygon points="${area}" fill="${fill}"/><polyline points="${line}" fill="none" stroke="${color}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="${pts[pts.length-1][0]}" cy="${pts[pts.length-1][1]}" r="2.5" fill="${color}"/></svg>`;
}

// ── PULSE STRIP ──
function renderPulse(){
  const picks=[
    {label:'S&P 500',sec:1,idx:2},{label:'DJIA',sec:1,idx:0},
    {label:'Mortgage',sec:3,idx:0},{label:'Inflation',sec:0,idx:0},
    {label:'Unemployment',sec:0,idx:1},{label:'Gas',sec:5,idx:0},{label:'Eggs',sec:4,idx:1}
  ];
  document.getElementById('pulse').innerHTML=picks.map(p=>{
    const ind=SECTIONS[p.sec].indicators[p.idx],last=ind.data[ind.data.length-1],prev=ind.data[ind.data.length-2];
    const d=last-prev,cls=Math.abs(d)<0.001?'':(d>0)===ind.upIsBad?'pulse-dn':'pulse-up';
    const arrow=d>0?'\u25B2':d<0?'\u25BC':'\u2014';
    return`<div class="pulse-item"><span class="pulse-label">${p.label}</span><span class="pulse-val ${cls}">${fmt(last,ind.dec)} ${arrow}</span></div>`;
  }).join('');
}

// ── NARRATIVE ──
function renderNarrative(){
  document.getElementById('narrative').innerHTML=`
  <div class="narrative-card">
    <div class="byline">The Titan Index &bull; Economic Analysis &bull; February 2026</div>
    <h2>A Year of Whiplash: Markets Soar, Confidence Craters, and the Middle Class Foots the Bill</h2>
    <p class="dropcap">Twelve months ago, the American economy stood at a crossroads. Inflation was cooling, the labor market was holding steady, and a new administration was promising a return to economic dominance. Today, the scorecard is decidedly mixed. The Dow Jones Industrial Average punched through 50,000 for the first time in history on February 6, capping a remarkable 13% surge from its inauguration-day level. The S&amp;P 500 and NASDAQ have followed suit, sitting near all-time highs. On paper, this is a golden age for investors.</p>
    <p>But paper wealth tells only half the story. <strong>Consumer confidence has plummeted to 80.0</strong> &mdash; its lowest reading since May 2014 &mdash; even as stock portfolios fatten. The disconnect is jarring but not mysterious: the Americans who own stocks are doing well, while the roughly half of households without meaningful equity exposure are living in a different economy entirely. Credit card debt has swelled to a record <strong>$11,000 per household</strong>, new car prices have permanently crossed the $49,000 threshold, and housing remains brutally unaffordable at 4.6 times median income, well above the historical norm of 3.5&times;. Wages are rising &mdash; median household income has climbed to $85,800 &mdash; but the cumulative weight of <strong>23% post-pandemic inflation</strong> means every dollar buys meaningfully less than it did in 2020.</p>
    <p>The bright spots are real, if narrow. Egg prices have collapsed 58% from their avian-flu peak, gasoline has dipped below $3 for the first time since 2021, and mortgage rates have fallen nearly 80 basis points as the Fed delivered three rate cuts. But these relief valves can't offset the structural pressures. <strong>April's tariff-driven market crash</strong> &mdash; which erased 19% from the S&amp;P in weeks &mdash; demonstrated how quickly policy volatility can unwind months of gains. The recovery was swift, but the scars remain in the form of elevated VIX levels and 500-point daily swings that have become routine.</p>
    <p>The bottom line: if you own a home and a portfolio, 2025-26 has been lucrative. If you're a renter, a first-time buyer, or someone living paycheck to paycheck, the economy feels worse than the headline numbers suggest &mdash; because for you, it <em>is</em> worse. Presidential approval has slid from 48% to 42%, reflecting a broad sense that prosperity isn't reaching Main Street. The Titan Index's Richter Scale below rates the current stress level at <strong>5.1 out of 10</strong> &mdash; moderate stress, not a crisis, but well above calm &mdash; with consumer confidence in freefall and trade policy uncertainty running high, the fault lines are worth watching closely.</p>
  </div>`;
}

// ── SUMMARY ──
function renderSummary(){
  document.getElementById('summary').innerHTML=`
  <div class="summary-card">
    <div class="summary-title">\u{1F9E0} What This Means For You (Feb 2025 \u2192 Feb 2026)</div>
    <div class="summary-grid">
      <div class="sum-sec hl-g">
        <h3>\u2705 Top 4 Highlights</h3>
        <ul>
          <li><strong>Egg prices collapsed 58%:</strong> From a record $6.23/doz (Mar peak) to $2.50 as avian flu recovery boosted production back to normal.</li>
          <li><strong>Gas below $3 for first time since 2021:</strong> National avg dropped from $3.12 to $2.93/gal, saving ~$3 per fill-up.</li>
          <li><strong>Mortgage rates down 78 bps:</strong> 30-yr rate fell from 6.87% to 6.09% (spiked to 6.85% in Jun before 3 Fed cuts), saving ~$120/mo on a $400K loan.</li>
          <li><strong>Wages outpacing inflation:</strong> Median household income up ~$1,700 (2.0%) while CPI moderated from 2.8% to 2.4%.</li>
        </ul>
      </div>
      <div class="sum-sec hl-b">
        <h3>\u26A0\uFE0F Top 4 Lowlights</h3>
        <ul>
          <li><strong>New cars hit record $50K+:</strong> Avg transaction price broke $50,326 in Dec, up $2,287 (4.8%) from Feb baseline.</li>
          <li><strong>Markets whipsawed hard:</strong> April tariff crash wiped ~19% off the S&amp;P; markets roared back to record highs &mdash; Dow crossed 50,000 for the first time (Feb 6) &mdash; but volatility remains elevated with 500+ point swings on AI and tariff fears.</li>
          <li><strong>Credit card debt at record:</strong> Total US CC debt hit $1.28 trillion in Q4; avg household balance peaked at ~$11,300.</li>
          <li><strong>Housing still stretched:</strong> Median home peaked at $435K in Jun; price-to-income still above 4.6\u00D7 (historic avg is 3.5\u00D7).</li>
        </ul>
      </div>
      <div class="sum-div">
        <h3>\u{1F9FE} Who's Better vs. Worse Off?</h3>
        <ul>
          <li>\u{1F48E} <strong>Better off:</strong> Homeowners with locked-in rates saw equity grow. Those who held stocks through the April crash saw the S&amp;P rally 15% from its low. Gas and grocery savings benefit everyone.</li>
          <li>\u{1F3E0} <strong>Squeezed:</strong> Middle class \u2014 wages rising but outpaced by record car prices, stubborn housing costs, and growing credit card balances. Consumer confidence near lowest since 2014 despite stock market records.</li>
          <li>\u{1F4B8} <strong>Worse off:</strong> Renters and first-time buyers \u2014 homes still unaffordable despite rate drops. Lower-income hammered by Q1 egg spike. Approval rating decline (48% \u2192 42%) signals broad discontent.</li>
        </ul>
      </div>
    </div>
  </div>`;
}

// ── SECTIONS & TABLES ──
const tableWraps = [];

function renderSections(){
  const el=document.getElementById('sections');
  el.innerHTML=SECTIONS.map((sec,si)=>{
    const rows=sec.indicators.map((ind,ii)=>{
      const baseline=ind.data[0];
      const baseCell=`<td class="v-base">${fmt(baseline,ind.dec)}</td>`;
      const monthCells=ind.data.slice(1).map((v,mi)=>{
        const prev=ind.data[mi];
        return`<td class="${cellCls(v,prev,ind.upIsBad)}">${fmt(v,ind.dec)}</td>`;
      }).join('');
      const last=ind.data[ind.data.length-1];
      const pctChg=((last-baseline)/Math.abs(baseline))*100;
      return`<tr data-s="${si}" data-i="${ii}" role="button" tabindex="0" aria-label="View chart: ${ind.name}"><td><a class="ind-link" href="${ind.url}" target="_blank" rel="noopener" title="View source: ${ind.name}" onclick="event.stopPropagation()">${ind.name}</a></td>${baseCell}${monthCells}<td>${sparkSVG(ind.data,ind.upIsBad)}</td><td class="${pctChgCls(pctChg,ind.upIsBad)}">${fmtPct(pctChg)}</td></tr>`;
    }).join('');
    const monthHeaders=MONTHS.slice(1).map(m=>`<th>${m}</th>`).join('');
    return`<div class="section"><div class="section-hdr"><span>${sec.icon}</span><span>${sec.title}</span></div><div class="time-slider-bar"><label>Timeline</label><input type="range" class="time-slider" min="0" max="100" value="100" data-sec="${si}"><span class="time-slider-range" data-sec="${si}">Sep 25 \u2013 Feb 26</span></div><div class="table-wrap" data-sec="${si}"><table class="t"><thead><tr><th>Indicator</th><th>Feb 25</th>${monthHeaders}<th>Trend</th><th>% Since Inaug.</th></tr></thead><tbody>${rows}</tbody></table></div></div>`;
  }).join('');

  // Row click handlers
  el.querySelectorAll('tr[data-s]').forEach(tr=>{
    const handler=()=>{openModal(SECTIONS[+tr.dataset.s].indicators[+tr.dataset.i],SECTIONS[+tr.dataset.s].accent)};
    tr.addEventListener('click',handler);
    tr.addEventListener('keydown',e=>{if(e.key==='Enter')handler()});
  });

  // Slider sync
  el.querySelectorAll('.time-slider').forEach(slider=>{
    const si=slider.dataset.sec;
    const wrap=el.querySelector(`.table-wrap[data-sec="${si}"]`);
    tableWraps.push(wrap);

    slider.addEventListener('input',()=>{
      const pct=+slider.value/100;
      const maxScroll=wrap.scrollWidth-wrap.clientWidth;
      wrap.scrollLeft=pct*maxScroll;
      updateSliderLabel(si,wrap);
    });

    wrap.addEventListener('scroll',()=>{
      const maxScroll=wrap.scrollWidth-wrap.clientWidth;
      if(maxScroll>0) slider.value=Math.round((wrap.scrollLeft/maxScroll)*100);
      updateSliderLabel(si,wrap);
    });
  });

  // Scroll all tables to show last 6 months
  requestAnimationFrame(()=>{
    el.querySelectorAll('.table-wrap').forEach(wrap=>{
      wrap.scrollLeft=wrap.scrollWidth-wrap.clientWidth;
      const si=wrap.dataset.sec;
      updateSliderLabel(si,wrap);
    });
  });
}

function updateSliderLabel(si,wrap){
  const label=document.querySelector(`.time-slider-range[data-sec="${si}"]`);
  if(!label)return;
  const table=wrap.querySelector('table');
  const ths=table.querySelectorAll('thead th');
  const wrapRect=wrap.getBoundingClientRect();
  const visibleMonths=[];
  for(let i=2;i<ths.length-2;i++){
    const thRect=ths[i].getBoundingClientRect();
    if(thRect.right>wrapRect.left+210 && thRect.left<wrapRect.right){
      visibleMonths.push(ths[i].textContent);
    }
  }
  if(visibleMonths.length>=2){
    label.textContent=visibleMonths[0]+' \u2013 '+visibleMonths[visibleMonths.length-1];
  }else if(visibleMonths.length===1){
    label.textContent=visibleMonths[0];
  }
}

// ── MODAL CHART ──
let chartInst=null;
let currentModalInd=null;
let currentModalAccent=null;
let currentTab='12m';

function openModal(ind,accent){
  currentModalInd=ind;
  currentModalAccent=accent;
  currentTab='12m';
  const overlay=document.getElementById('modal');
  document.getElementById('modal-title').textContent=ind.name;

  // Reset tabs
  document.querySelectorAll('.modal-tab').forEach(t=>t.classList.remove('active'));
  document.querySelector('.modal-tab[data-tab="12m"]').classList.add('active');

  renderModalChart(ind,accent,'12m');
  overlay.classList.add('open');
}

function renderModalChart(ind,accent,tab){
  const first=ind.data[0],last=ind.data[ind.data.length-1],delta=last-first;
  const pct=((delta/Math.abs(first))*100).toFixed(1);
  const cc=pctChgCls(parseFloat(pct),ind.upIsBad);

  if(tab==='12m'){
    const min=Math.min(...ind.data),max=Math.max(...ind.data);
    document.getElementById('modal-stats').innerHTML=`
      <div class="modal-stat"><div class="lbl">Inauguration</div><div class="val">${fmt(first,ind.dec)}</div></div>
      <div class="modal-stat"><div class="lbl">Current</div><div class="val">${fmt(last,ind.dec)}</div></div>
      <div class="modal-stat"><div class="lbl">% Change</div><div class="val ${cc}">${fmtPct(parseFloat(pct))}</div></div>
      <div class="modal-stat"><div class="lbl">Low</div><div class="val">${fmt(min,ind.dec)}</div></div>
      <div class="modal-stat"><div class="lbl">High</div><div class="val">${fmt(max,ind.dec)}</div></div>`;
    buildChart(MONTHS,[...ind.data],accent,ind);
  }else{
    const h=ind.hist||[];
    if(h.length){
      const hMin=Math.min(...h),hMax=Math.max(...h);
      const hFirst=h[0],hLast=h[h.length-1];
      const hPct=((hLast-hFirst)/Math.abs(hFirst)*100).toFixed(1);
      document.getElementById('modal-stats').innerHTML=`
        <div class="modal-stat"><div class="lbl">2006</div><div class="val">${fmt(hFirst,ind.dec)}</div></div>
        <div class="modal-stat"><div class="lbl">2026</div><div class="val">${fmt(hLast,ind.dec)}</div></div>
        <div class="modal-stat"><div class="lbl">20-Yr Change</div><div class="val ${pctChgCls(parseFloat(hPct),ind.upIsBad)}">${fmtPct(parseFloat(hPct))}</div></div>
        <div class="modal-stat"><div class="lbl">20-Yr Low</div><div class="val">${fmt(hMin,ind.dec)}</div></div>
        <div class="modal-stat"><div class="lbl">20-Yr High</div><div class="val">${fmt(hMax,ind.dec)}</div></div>`;
      buildChart(HIST_YEARS,[...h],accent,ind);
    }
  }
  document.getElementById('modal-src').innerHTML=`Data source: <a href="${ind.url}" target="_blank" rel="noopener">${ind.url.replace(/^https?:\/\/(www\.)?/,'').split('/')[0]}</a>`;
}

function isLight(){return document.documentElement.dataset.theme==='light'}

function buildChart(labels,data,accent,ind){
  if(chartInst)chartInst.destroy();
  const lt=isLight();
  const ctx=document.getElementById('modal-canvas').getContext('2d');
  const gradPlugin={id:'gfill',beforeDatasetsDraw(chart){
    const{ctx:c,chartArea:a}=chart;if(!a)return;
    const g=c.createLinearGradient(0,a.top,0,a.bottom);
    g.addColorStop(0,hexRgba(accent,.28));g.addColorStop(1,hexRgba(accent,.02));
    chart.data.datasets[0].backgroundColor=g;
  }};
  chartInst=new Chart(ctx,{
    type:'line',
    data:{labels,datasets:[{label:ind.name,data,fill:true,backgroundColor:hexRgba(accent,.15),borderColor:accent,borderWidth:2.5,tension:.3,pointRadius:labels.length>15?3:5,pointBackgroundColor:accent,pointBorderColor:lt?'#fff':'#0d1117',pointBorderWidth:2,pointHoverRadius:7}]},
    options:{responsive:true,maintainAspectRatio:true,interaction:{intersect:false,mode:'index'},
      plugins:{legend:{display:false},tooltip:{backgroundColor:lt?'#fff':'#161b22',borderColor:lt?'#d0d7de':'#30363d',borderWidth:1,titleColor:lt?'#1f2328':'#e6edf3',bodyColor:lt?'#656d76':'#8b949e',padding:12,cornerRadius:8,displayColors:false,callbacks:{label:c=>`${ind.name}: ${fmt(c.parsed.y,ind.dec)}`}}},
      scales:{x:{ticks:{color:lt?'#656d76':'#8b949e',font:{size:11},maxRotation:45},grid:{color:lt?'#d0d7de':'#21262d'}},y:{ticks:{color:lt?'#656d76':'#8b949e',font:{size:12},callback:v=>fmt(v,ind.dec)},grid:{color:lt?'#d0d7de':'#21262d'}}}
    },
    plugins:[gradPlugin]
  });
}

// Tab switching
document.getElementById('modal-tabs').addEventListener('click',e=>{
  const tab=e.target.dataset?.tab;
  if(!tab||!currentModalInd)return;
  currentTab=tab;
  document.querySelectorAll('.modal-tab').forEach(t=>t.classList.remove('active'));
  e.target.classList.add('active');
  renderModalChart(currentModalInd,currentModalAccent,tab);
});

function closeModal(){document.getElementById('modal').classList.remove('open');if(chartInst){chartInst.destroy();chartInst=null};currentModalInd=null}
document.getElementById('modal-close').addEventListener('click',closeModal);
document.getElementById('modal').addEventListener('click',e=>{if(e.target===e.currentTarget)closeModal()});
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal()});

// ── RICHTER SCALE ──
function renderRichter(){
  function severity(item){
    // Normalize each metric to 0-10 scale based on how bad it is relative to worst crisis
    const vals=[Math.abs(item.current),Math.abs(item.gfc),Math.abs(item.covid),Math.abs(item.dotcom)];
    const worst=Math.max(Math.abs(item.gfc),Math.abs(item.covid),Math.abs(item.dotcom));
    if(worst===0)return 1;
    if(item.invert){
      // For inverted metrics (drawdown, confidence), lower current = worse
      // For confidence: lower is worse. current=80, gfc=25 means current is mild
      if(item.name.includes('Confidence')){
        const range=140-25; // max confidence - worst crisis
        const distFromWorst=item.current-25;
        return Math.max(1,Math.min(10,10-((distFromWorst/range)*9)));
      }
      // For drawdowns: more negative = worse
      const ratio=Math.abs(item.current)/worst;
      return Math.max(1,Math.min(10,1+ratio*9));
    }else{
      // For direct metrics: higher = worse (unemployment, inflation, debt, rates)
      const ratio=item.current/worst;
      return Math.max(1,Math.min(10,1+ratio*9));
    }
  }

  function positionPct(val,max,invert){
    if(invert)return Math.max(0,Math.min(100,(1-Math.abs(val)/max)*100));
    return Math.max(0,Math.min(100,(Math.abs(val)/max)*100));
  }

  function severityColor(s){
    if(s<=2.5)return'var(--green)';
    if(s<=5)return'var(--amber)';
    if(s<=7.5)return'var(--orange)';
    return'var(--red)';
  }

  function fmtRichterVal(v,unit){
    if(unit==='$')return'$'+v.toLocaleString();
    if(unit==='%')return v.toFixed(1)+'%';
    return v.toFixed(1);
  }

  const scores=RICHTER_DATA.map(d=>severity(d));
  const avgScore=(scores.reduce((a,b)=>a+b,0)/scores.length);

  const rows=RICHTER_DATA.map((d,i)=>{
    const s=scores[i];
    const col=severityColor(s);
    // Position markers
    const maxVal=d.max;
    function pct(v){
      if(d.name.includes('Confidence'))return Math.max(2,Math.min(98,((v)/maxVal)*100));
      if(d.invert)return Math.max(2,Math.min(98,(Math.abs(v)/maxVal)*100));
      return Math.max(2,Math.min(98,(Math.abs(v)/maxVal)*100));
    }
    return`<div class="richter-row">
      <div class="richter-label">${d.name}<span>${d.sub}: ${fmtRichterVal(d.current,d.unit)}</span></div>
      <div class="richter-bar-wrap">
        <div class="richter-bar-bg"></div>
        <div class="richter-markers">
          <div class="richter-marker" style="left:${pct(d.gfc)}%;background:#f85149"><div class="richter-marker-label">'08</div></div>
          <div class="richter-marker" style="left:${pct(d.covid)}%;background:#d29922"><div class="richter-marker-label">COVID</div></div>
          <div class="richter-marker" style="left:${pct(d.dotcom)}%;background:#bc8cff"><div class="richter-marker-label">'01</div></div>
          <div class="richter-marker current" style="left:${pct(d.current)}%;background:${col}"><div class="richter-marker-label" style="top:auto;bottom:-18px;color:var(--text);font-weight:700">NOW</div></div>
        </div>
      </div>
      <div class="richter-score" style="color:${col}">${s.toFixed(1)}</div>
    </div>`;
  }).join('');

  const overallColor=severityColor(avgScore);
  const overallLabel=avgScore<=2.5?'Calm':avgScore<=4?'Mild Tremor':avgScore<=6?'Moderate Stress':avgScore<=8?'Severe Strain':'Crisis';
  const overallDesc=avgScore<=3.5?
    'Current economic conditions show localized stress in consumer sentiment and household debt, but systemic risk indicators remain well below crisis thresholds. The economy is experiencing tremors, not an earthquake.':
    'Multiple indicators are flashing warning signs. While not at crisis levels, the combination of elevated debt, falling confidence, and policy uncertainty creates meaningful downside risk.';

  document.getElementById('richter').innerHTML=`
  <div class="richter-card">
    <div class="richter-title">\u{1F30B} Economic Richter Scale</div>
    <div class="richter-subtitle">Comparing current conditions to the 2008 Financial Crisis, COVID-19 Crash, and Dot-Com Bust (1 = calm, 10 = crisis)</div>
    ${rows}
    <div class="richter-legend">
      <div class="richter-legend-item"><div class="richter-legend-dot" style="background:#f85149"></div>2008 Financial Crisis</div>
      <div class="richter-legend-item"><div class="richter-legend-dot" style="background:#d29922"></div>COVID-19 (2020)</div>
      <div class="richter-legend-item"><div class="richter-legend-dot" style="background:#bc8cff"></div>Dot-Com Bust (2001)</div>
      <div class="richter-legend-item"><div class="richter-legend-dot" style="border:2px solid #fff;width:8px;height:8px"></div>Current (Feb 2026)</div>
    </div>
    <div class="richter-overall">
      <div class="score" style="color:${overallColor}">${avgScore.toFixed(1)}<span style="font-size:20px;color:var(--text-m)"> / 10</span></div>
      <div class="label" style="color:${overallColor}">${overallLabel}</div>
      <div class="desc">${overallDesc}</div>
    </div>
  </div>`;
}

// ── HERO CANVAS ──
function initHeroCanvas(){
  const c=document.getElementById('hero-canvas'),ctx=c.getContext('2d');
  let w,h;
  function resize(){
    const dpr=devicePixelRatio||1;
    w=c.offsetWidth;h=c.offsetHeight;
    c.width=w*dpr;c.height=h*dpr;
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  resize();
  addEventListener('resize',resize);

  const lines=[
    {c:'#58a6ff',w:2.5,s:0.4,base:0.42,waves:[{a:35,f:1.2,p:0},{a:15,f:2.8,p:1.5},{a:8,f:4.1,p:3}]},
    {c:'#bc8cff',w:2,s:0.3,base:0.55,waves:[{a:28,f:1.5,p:2},{a:12,f:3.2,p:0.8},{a:6,f:5,p:4}]},
    {c:'#3fb950',w:1.5,s:0.35,base:0.65,waves:[{a:22,f:1.8,p:4},{a:10,f:3.5,p:2.5},{a:5,f:4.8,p:1}]},
    {c:'#d29922',w:1.5,s:0.25,base:0.32,waves:[{a:18,f:1.3,p:1},{a:8,f:2.5,p:3.5},{a:4,f:4.5,p:5}]}
  ];

  let t=0;
  function getY(line,nx){
    let y=h*line.base;
    for(const wv of line.waves)y+=Math.sin(nx*Math.PI*wv.f+t*line.s+wv.p)*wv.a;
    return y;
  }

  (function draw(){
    ctx.clearRect(0,0,w,h);
    const lt=document.documentElement.dataset.theme==='light';
    for(const line of lines){
      const n=Math.ceil(w/6);
      ctx.beginPath();
      for(let i=0;i<=n;i++){
        const x=(i/n)*w,y=getY(line,i/n);
        i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
      }
      ctx.strokeStyle=line.c;
      ctx.globalAlpha=lt?0.18:0.35;
      ctx.lineWidth=line.w;
      ctx.stroke();
      ctx.lineTo(w,h);ctx.lineTo(0,h);ctx.closePath();
      const g=ctx.createLinearGradient(0,0,0,h);
      g.addColorStop(0,line.c+(lt?'10':'18'));
      g.addColorStop(1,line.c+'00');
      ctx.globalAlpha=1;
      ctx.fillStyle=g;
      ctx.fill();
    }
    t+=0.008;
    requestAnimationFrame(draw);
  })();
}

// ── INIT ──
initHeroCanvas();
renderPulse();
renderNarrative();
renderSummary();
renderSections();
renderRichter();

// ── THEME TOGGLE ──
(function(){
  const btn=document.getElementById('theme-toggle');
  function applyTheme(theme){
    if(theme==='light'){
      document.documentElement.dataset.theme='light';
      btn.innerHTML='&#9788;';
      btn.title='Switch to dark mode';
    }else{
      delete document.documentElement.dataset.theme;
      btn.innerHTML='&#9790;';
      btn.title='Switch to light mode';
    }
  }
  applyTheme(localStorage.getItem('titan-theme')||'light');
  btn.addEventListener('click',()=>{
    const next=document.documentElement.dataset.theme==='light'?'dark':'light';
    localStorage.setItem('titan-theme',next);
    applyTheme(next);
  });
})();

// ── SUBSCRIBE (Supabase) ──
const SUPABASE_URL='https://tcbspypfypxbwnwxsumw.supabase.co';
const SUPABASE_ANON_KEY='sb_publishable_O60Jo7Q3v8xJJ_tjmGyEFg_tlu0AqTF';

document.getElementById('subscribe-form').addEventListener('submit',async function(e){
  e.preventDefault();
  const msg=document.getElementById('subscribe-msg');
  const email=document.getElementById('subscribe-email').value.trim();
  const btn=this.querySelector('button');
  if(!SUPABASE_URL||!SUPABASE_ANON_KEY){
    msg.textContent='Mailing list coming soon!';
    msg.className='subscribe-msg error';
    return;
  }
  btn.disabled=true;
  btn.textContent='Subscribing\u2026';
  msg.textContent='';msg.className='subscribe-msg';
  try{
    const res=await fetch(SUPABASE_URL+'/rest/v1/subscribers',{
      method:'POST',
      headers:{'Content-Type':'application/json','apikey':SUPABASE_ANON_KEY,'Authorization':'Bearer '+SUPABASE_ANON_KEY,'Prefer':'return=minimal'},
      body:JSON.stringify({email})
    });
    if(res.ok||res.status===201){
      msg.textContent='You\u2019re subscribed! Watch for the next Titan Index.';
      msg.className='subscribe-msg success';
      document.getElementById('subscribe-email').value='';
    }else if(res.status===409){
      msg.textContent='You\u2019re already subscribed!';
      msg.className='subscribe-msg success';
    }else{
      const err=await res.json().catch(()=>({}));
      throw new Error(err.message||'Subscription failed');
    }
  }catch(ex){
    msg.textContent=ex.message||'Something went wrong. Try again.';
    msg.className='subscribe-msg error';
  }finally{
    btn.disabled=false;
    btn.textContent='Subscribe';
  }
});
</script>
</body>
</html>
